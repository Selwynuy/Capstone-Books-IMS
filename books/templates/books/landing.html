{% extends 'books/base.html' %}

{% block title %}Capstone Books - Advanced Search{% endblock %}

{% block head %}
<style>
    .search-container {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 60vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .search-box {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        max-width: 600px;
        width: 100%;
    }
    
    .search-input {
        transition: all 0.3s ease;
        border: 2px solid #e5e7eb;
    }
    
    .search-input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .filter-chip {
        background: #f3f4f6;
        border: 1px solid #d1d5db;
        transition: all 0.2s ease;
    }
    
    .filter-chip:hover {
        background: #e5e7eb;
        border-color: #667eea;
    }
    
    .filter-chip.active {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }
</style>
{% endblock %}

{% block content %}
<div class="search-container">
    <div class="search-box">
        <h1 class="text-3xl font-bold text-gray-800 text-center mb-8">
            üîç Search Capstone Books
        </h1>
        
        <form id="advanced-search" hx-get="{% url 'book_list' %}" hx-target="#search-results" hx-trigger="input changed delay:500ms, submit">
            <!-- Main Search Input -->
            <div class="mb-6 relative">
                <input
                    type="text"
                    name="search"
                    placeholder="Search by title, author, or keyword..."
                    class="search-input w-full p-4 pl-12 text-lg rounded-lg outline-none"
                />
                <i class="fa-solid fa-magnifying-glass text-gray-400 absolute left-4 top-4 text-xl"></i>
            </div>
            
            <!-- Filter Categories -->
            <div class="space-y-4">
                <!-- Search By Category -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Search By:</label>
                    <div class="flex flex-wrap gap-2">
                        <button type="button" class="filter-chip px-3 py-1 rounded-full text-sm active" data-filter="all">
                            All
                        </button>
                        <button type="button" class="filter-chip px-3 py-1 rounded-full text-sm" data-filter="title">
                            Title Only
                        </button>
                        <button type="button" class="filter-chip px-3 py-1 rounded-full text-sm" data-filter="author">
                            Author Only
                        </button>
                        <button type="button" class="filter-chip px-3 py-1 rounded-full text-sm" data-filter="panelist">
                            Panelist Only
                        </button>
                    </div>
                </div>
                
                <!-- Authors Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Filter by Author:</label>
                    <select name="author" class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-blue-500">
                        <option value="">All Authors</option>
                        {% for author in authors %}
                            <option value="{{ author.id }}">{{ author.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- Advisers Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Filter by Adviser:</label>
                    <select name="adviser" class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-blue-500">
                        <option value="">All Advisers</option>
                        {% for adviser in advisers %}
                            <option value="{{ adviser.id }}">{{ adviser.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- Availability Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Availability:</label>
                    <div class="flex gap-4">
                        <label class="flex items-center">
                            <input type="radio" name="availability" value="" class="mr-2" checked>
                            All Books
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="availability" value="available" class="mr-2">
                            Available Only
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="availability" value="checked_out" class="mr-2">
                            Checked Out
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Search Button -->
            <button
                type="submit"
                class="w-full mt-6 bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg text-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-300"
            >
                üîç Search Books
            </button>
        </form>
    </div>
</div>

<!-- Search Results -->
<div id="search-results" class="container mx-auto px-4 py-8">
    <!-- Results will be loaded here via HTMX -->
</div>

<script>
// Handle filter chips
document.querySelectorAll('.filter-chip').forEach(chip => {
    chip.addEventListener('click', function() {
        // Remove active class from all chips
        document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
        // Add active class to clicked chip
        this.classList.add('active');
        
        // Set search type hidden input
        let searchType = this.dataset.filter;
        let existingInput = document.querySelector('input[name="search_type"]');
        if (existingInput) {
            existingInput.remove();
        }
        
        const hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'search_type';
        hiddenInput.value = searchType;
        document.getElementById('advanced-search').appendChild(hiddenInput);
        
        // Trigger search
        document.getElementById('advanced-search').dispatchEvent(new Event('input'));
    });
});
</script>
{% endblock %} 